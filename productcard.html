<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Product Master - Card View</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-4">

    <h3 class="mb-3">ðŸ›’ Product Master</h3>

    <!-- FORM -->
    <div class="card mb-4">
        <div class="card-header fw-bold">Product Details</div>
        <div class="card-body">
            <form id="productForm">

                <input type="hidden" id="editIndex">
                <input type="hidden" id="existingImage">

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label">Title</label>
                        <input type="text" id="title" class="form-control">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Path URL</label>
                        <input type="text" id="pathUrl" class="form-control">
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label">Header</label>
                    <textarea id="header" class="form-control"></textarea>
                </div>

                <div class="mb-3">
                    <label class="form-label">Description</label>
                    <textarea id="description" class="form-control"></textarea>
                </div>

                <div class="row mb-3">
                    <div class="col-md-4">
                        <label class="form-label">Category</label>
                        <select id="category" class="form-select">
                            <option value="">Select</option>
                            <option>Electronics</option>
                            <option>Solar</option>
                            <option>Software</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Sub Category</label>
                        <select id="subCategory" class="form-select">
                            <option value="">Select</option>
                            <option>Panel</option>
                            <option>Inverter</option>
                            <option>Service</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Price</label>
                        <input type="number" id="price" class="form-control">
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label">Image</label>
                    <input type="file" id="image" class="form-control" accept="image/*">
                    <img id="preview" class="mt-2 rounded" width="120" style="display:none;">
                </div>

                <div class="text-end">
                    <button type="button" class="btn btn-success" onclick="saveProduct()">Save</button>
                    <button type="reset" class="btn btn-secondary" onclick="clearPreview()">Clear</button>
                </div>

            </form>
        </div>
    </div>

    <!-- CARD LISTING -->
    <div class="row g-4" id="productCards"></div>

</div>

<script>
    let products = JSON.parse(localStorage.getItem("products")) || [];

    image.addEventListener("change", function () {
        const reader = new FileReader();
        reader.onload = () => {
            preview.src = reader.result;
            preview.style.display = "block";
        };
        reader.readAsDataURL(this.files[0]);
    });

    function saveProduct() {
        let imgData = existingImage.value;
        if (image.files[0]) imgData = preview.src;

        const product = {
            title: title.value,
            header: header.value,
            description: description.value,
            pathUrl: pathUrl.value,
            category: category.value,
            subCategory: subCategory.value,
            price: price.value,
            image: imgData
        };

        if (editIndex.value === "") {
            products.push(product);
        } else {
            products[editIndex.value] = product;
            editIndex.value = "";
        }

        localStorage.setItem("products", JSON.stringify(products));
        productForm.reset();
        clearPreview();
        loadProducts();
    }

    function loadProducts() {
        productCards.innerHTML = "";
        products.forEach((p, i) => {
            productCards.innerHTML += `
                <div class="col-md-4">
                    <div class="card h-100 shadow-sm">
                        <img src="${p.image}" class="card-img-top" style="height:200px; object-fit:cover">
                        <div class="card-body">
                            <h5 class="card-title">${p.title}</h5>
                            <p class="text-muted mb-1">${p.category} â€¢ ${p.subCategory}</p>
                            <p class="fw-bold text-success">â‚¹ ${p.price}</p>
                            <p class="small">${p.description}</p>
                            <span class="badge bg-secondary">${p.pathUrl}</span>
                        </div>
                        <div class="card-footer text-end">
                            <button class="btn btn-sm btn-warning" onclick="editProduct(${i})">Edit</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteProduct(${i})">Delete</button>
                        </div>
                    </div>
                </div>
            `;
        });
    }

    function editProduct(index) {
        const p = products[index];
        title.value = p.title;
        header.value = p.header;
        description.value = p.description;
        pathUrl.value = p.pathUrl;
        category.value = p.category;
        subCategory.value = p.subCategory;
        price.value = p.price;
        preview.src = p.image;
        preview.style.display = "block";
        existingImage.value = p.image;
        editIndex.value = index;
    }

    function deleteProduct(index) {
        if (confirm("Delete this product?")) {
            products.splice(index, 1);
            localStorage.setItem("products", JSON.stringify(products));
            loadProducts();
        }
    }

    function clearPreview() {
        preview.style.display = "none";
        preview.src = "";
        existingImage.value = "";
    }

    loadProducts();
</script>

</body>
</html>
